# P2P 聊天

![P2P Chat](https://img.shields.io/badge/P2P-Chat-blue)
![WebRTC](https://img.shields.io/badge/WebRTC-RTCPeerConnection-green)
![License](https://img.shields.io/badge/License-MIT-yellow)

基于 WebRTC 技术构建的点对点加密聊天应用，无需服务器即可实现安全通信。支持文本、图片、语音消息和视频通话等多种通信方式。

## ✨ 特性

- **无服务器架构**：完全基于浏览器间点对点连接，无需中央服务器
- **端到端加密**：WebRTC 内置的安全传输层保障数据安全
- **多媒体消息**：
    - 💬 文本消息（支持多行文本和换行）
    - 🖼️ 图片分享（自动压缩优化）
    - 🎤 语音消息
    - 📹 视频通话
- **链接预览**：自动识别聊天中的链接并生成预览
- **连接质量监控**：实时监测与显示网络连接状态
- **响应式设计**：完美支持移动端和桌面端
- **极低延迟**：直接点对点连接确保通信延迟最小化
- **无痕通信**：聊天记录仅保存在内存中，刷新页面后自动清除

## 📋 使用指南

### 建立连接

1. 第一个用户点击「创建连接请求」按钮
2. 复制生成的连接信息
3. 将连接信息发送给对方（通过任何通信方式）
4. 第二个用户点击「创建连接响应」按钮
5. 第二个用户粘贴收到的连接信息，系统生成响应信息
6. 第二个用户将响应信息发送给第一个用户
7. 第一个用户点击「处理对方响应」并粘贴收到的响应信息
8. 连接建立成功，开始聊天！

### 多媒体功能

- **发送图片**：点击「图片」按钮选择本地图片
- **录制语音**：按住「录音」按钮录制语音消息，松开发送
- **视频通话**：点击「视频」按钮发起视频通话请求
- **文本消息**：在输入框中输入文本，按 Ctrl+Enter 发送（回车键用于换行）

## 🔒 隐私与安全

- **无数据存储**：所有通信数据均不会存储在任何服务器上
- **按需权限**：仅在用户主动使用相关功能时才请求摄像头/麦克风权限
- **资源释放**：使用完毕后立即释放摄像头和麦克风资源
- **安全传输**：基于 DTLS 和 SRTP 的加密传输

## 💻 技术栈

- WebRTC API (RTCPeerConnection)
- JavaScript (ES6+)
- HTML5 / CSS3
- MediaStream API
- Web Audio API
- ICE 框架 (STUN/TURN)

## 🌐 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+
- Opera 47+
- iOS Safari 11+
- Android Chrome 60+

## 🔧 高级配置

可通过修改 `Config` 对象自定义以下配置：

- ICE 服务器设置（STUN/TURN）
- 媒体配置（压缩率、最大大小）
- 连接超时设置
- 重连策略

## ⚙️ 离线使用

该应用可完全离线使用，无需互联网连接即可在局域网内工作。

## 🛠️ 开发

1. 克隆仓库
   ```bash
   git clone https://github.com/git-hub-cc/P2P-Web-Chat.git
   ```

2. 使用本地 HTTP 服务器运行
   ```bash
   # 使用 Python 内置的 HTTP 服务器
   python -m http.server
   # 或使用 Node.js http-server
   npx http-server
   ```

3. 在浏览器中访问 `http://localhost:8000`

## 🤝 贡献指南

欢迎提交 Pull Request 或创建 Issue 来帮助改进这个项目！

## 📜 许可证

该项目采用 [MIT 许可证](LICENSE)。

## 💡 实现原理

该应用利用 WebRTC 技术建立浏览器之间的点对点连接：

1. **信令阶段**：通过复制粘贴 SDP 信息完成连接协商
2. **ICE 候选收集**：获取可能的连接路径（本地、反射和中继候选）
3. **点对点数据通道**：一旦连接建立，所有通信通过加密数据通道进行
4. **媒体流处理**：语音和视频功能使用 MediaStream API 捕获和处理

## ⚠️ 限制与注意事项

- 建议先添加新聊天
- 对于 NAT 后的设备，可能需要配置 TURN 服务器以确保连接成功
- 大型文件传输会自动分块处理，但仍受限于 WebRTC 数据通道性能
- 为获得最佳体验，建议使用最新版本的主流浏览器

---

**注意**：此应用仅用于技术演示和学习目的。在处理敏感信息时，请确保使用经过充分安全审计的通信工具。